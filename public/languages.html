<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Generate beautiful Top Languages cards for your GitHub profile README.">
  <title>Top Languages Generator - DevCard</title>
  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <link rel="stylesheet" href="/styles/shared.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="/" class="logo">
          <i data-lucide="bar-chart-3"></i>
          <span>DevCard</span>
        </a>
        <nav class="nav-links">
          <a href="/stats.html" class="nav-link">
            <i data-lucide="bar-chart-2" style="width: 16px; height: 16px;"></i>
            Stats
          </a>
          <a href="/languages.html" class="nav-link active">
            <i data-lucide="code-2" style="width: 16px; height: 16px;"></i>
            Languages
          </a>
          <a href="/pin.html" class="nav-link">
            <i data-lucide="pin" style="width: 16px; height: 16px;"></i>
            Pin
          </a>
          <a href="https://github.com/paveg/devcard" class="nav-link" target="_blank" rel="noopener">
            <i data-lucide="github" style="width: 18px; height: 18px;"></i>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <h1 class="page-title">Top Languages Generator</h1>
      <p class="page-description">Display the programming languages you use most across your repositories.</p>

      <div class="generator-section">
        <div class="form-panel">
          <form id="generatorForm">
            <div class="form-group">
              <label for="username" class="form-label">GitHub Username *</label>
              <input type="text" id="username" class="input" placeholder="octocat" required>
            </div>

            <div class="form-group">
              <label for="theme" class="form-label">Theme</label>
              <select id="theme" class="select">
                <option value="">Default</option>
                <option value="dark">Dark</option>
                <option value="radical">Radical</option>
                <option value="tokyonight">Tokyo Night</option>
                <option value="dracula">Dracula</option>
                <option value="github_dark">GitHub Dark</option>
                <option value="github_light">GitHub Light</option>
                <option value="gruvbox">Gruvbox</option>
                <option value="nord">Nord</option>
                <option value="catppuccin_mocha">Catppuccin Mocha</option>
                <option value="catppuccin_latte">Catppuccin Latte</option>
                <option value="onedark">One Dark</option>
                <option value="cobalt">Cobalt</option>
                <option value="synthwave">Synthwave</option>
                <option value="transparent">Transparent</option>
                <option value="md3_light">Material 3 Light</option>
                <option value="md3_dark">Material 3 Dark</option>
                <option value="zinc">Zinc</option>
                <option value="slate">Slate</option>
              </select>
            </div>

            <div class="form-group">
              <label for="layout" class="form-label">Layout</label>
              <select id="layout" class="select">
                <option value="">Default</option>
                <option value="compact">Compact</option>
                <option value="donut">Donut</option>
                <option value="donut-vertical">Donut Vertical</option>
                <option value="pie">Pie</option>
              </select>
            </div>

            <div class="form-group">
              <label for="langs_count" class="form-label">Languages Count</label>
              <input type="number" id="langs_count" class="input" placeholder="5" min="1" max="20" value="5">
            </div>

            <div class="form-group">
              <label for="locale" class="form-label">Language</label>
              <select id="locale" class="select">
                <option value="">English</option>
                <option value="ja">Japanese</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Options</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="hide_border">
                  Hide Border
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="hide_title">
                  Hide Title
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="hide_progress">
                  Hide Progress
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="disable_animations">
                  No Animation
                </label>
              </div>
            </div>

            <div class="collapsible-header" onclick="toggleAdvanced()">
              <h3>Advanced Options</h3>
              <i data-lucide="chevron-down" id="advancedIcon" style="width: 16px; height: 16px;"></i>
            </div>
            <div class="collapsible-content" id="advancedOptions">
              <div class="form-group">
                <label for="custom_title" class="form-label">Custom Title</label>
                <input type="text" id="custom_title" class="input" placeholder="Most Used Languages">
              </div>

              <div class="form-group">
                <label for="hide" class="form-label">Hide Languages</label>
                <input type="text" id="hide" class="input" placeholder="html,css,javascript">
                <p class="form-hint">Comma-separated language names to exclude</p>
              </div>

              <div class="form-group">
                <label for="exclude_repo" class="form-label">Exclude Repositories</label>
                <input type="text" id="exclude_repo" class="input" placeholder="repo1,repo2">
                <p class="form-hint">Comma-separated repository names to exclude</p>
              </div>

              <div class="form-group">
                <label for="size_weight" class="form-label">Size Weight</label>
                <input type="number" id="size_weight" class="input" placeholder="1" min="0" max="1" step="0.1">
                <p class="form-hint">Weight for language size (0-1)</p>
              </div>

              <div class="form-group">
                <label for="count_weight" class="form-label">Count Weight</label>
                <input type="number" id="count_weight" class="input" placeholder="0" min="0" max="1" step="0.1">
                <p class="form-hint">Weight for language count (0-1)</p>
              </div>
            </div>

            <div class="form-group" style="margin-top: 1.5rem;">
              <button type="submit" class="button">
                <i data-lucide="image" style="width: 16px; height: 16px;"></i>
                Generate Card
              </button>
            </div>
          </form>
        </div>

        <div class="preview-panel">
          <div class="preview-header">
            <h2 class="preview-title">Preview</h2>
          </div>

          <div class="preview-container" id="preview">
            <div class="preview-loading" id="previewMessage">Enter a username to generate preview</div>
          </div>

          <div class="code-section" id="codeSection" style="display: none;">
            <div class="code-tabs">
              <button class="code-tab active" data-format="markdown">Markdown</button>
              <button class="code-tab" data-format="html">HTML</button>
              <button class="code-tab" data-format="url">URL</button>
            </div>
            <div class="code-block">
              <button class="copy-button" id="copyButton">
                <i data-lucide="copy" style="width: 14px; height: 14px;"></i>
              </button>
              <code id="codeOutput"></code>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>
        Made with care by <a href="https://github.com/paveg" target="_blank" rel="noopener">paveg</a>
        &bull;
        <a href="https://github.com/paveg/devcard" target="_blank" rel="noopener">View on GitHub</a>
      </p>
    </div>
  </footer>

  <script>
    lucide.createIcons();

    const form = document.getElementById('generatorForm');
    const preview = document.getElementById('preview');
    const previewMessage = document.getElementById('previewMessage');
    const codeSection = document.getElementById('codeSection');
    const codeOutput = document.getElementById('codeOutput');
    const codeTabs = document.querySelectorAll('.code-tab');
    const copyButton = document.getElementById('copyButton');

    let currentUrl = '';
    let currentFormat = 'markdown';
    let previewImg = null;

    function toggleAdvanced() {
      const content = document.getElementById('advancedOptions');
      const icon = document.getElementById('advancedIcon');
      content.classList.toggle('open');
      icon.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : '';
    }

    function buildUrl() {
      const baseUrl = window.location.origin;
      const params = new URLSearchParams();

      const username = document.getElementById('username').value.trim();
      if (!username) return null;

      params.set('username', username);

      const theme = document.getElementById('theme').value;
      if (theme) params.set('theme', theme);

      const layout = document.getElementById('layout').value;
      if (layout) params.set('layout', layout);

      const langsCount = document.getElementById('langs_count').value;
      if (langsCount && langsCount !== '5') params.set('langs_count', langsCount);

      const locale = document.getElementById('locale').value;
      if (locale) params.set('locale', locale);

      if (document.getElementById('hide_border').checked) params.set('hide_border', 'true');
      if (document.getElementById('hide_title').checked) params.set('hide_title', 'true');
      if (document.getElementById('hide_progress').checked) params.set('hide_progress', 'true');
      if (document.getElementById('disable_animations').checked) params.set('disable_animations', 'true');

      const customTitle = document.getElementById('custom_title').value.trim();
      if (customTitle) params.set('custom_title', customTitle);

      const hide = document.getElementById('hide').value.trim();
      if (hide) params.set('hide', hide);

      const excludeRepo = document.getElementById('exclude_repo').value.trim();
      if (excludeRepo) params.set('exclude_repo', excludeRepo);

      const sizeWeight = document.getElementById('size_weight').value;
      if (sizeWeight) params.set('size_weight', sizeWeight);

      const countWeight = document.getElementById('count_weight').value;
      if (countWeight) params.set('count_weight', countWeight);

      return `${baseUrl}/api/top-langs?${params.toString()}`;
    }

    function getCodeSnippet(url, format) {
      const username = document.getElementById('username').value.trim();
      switch (format) {
        case 'markdown':
          return `![${username}'s Top Languages](${url})`;
        case 'html':
          return `<img src="${url}" alt="${username}'s Top Languages" />`;
        case 'url':
          return url;
        default:
          return url;
      }
    }

    function updateCodeOutput() {
      if (!currentUrl) return;
      codeOutput.textContent = getCodeSnippet(currentUrl, currentFormat);
    }

    function showPreviewMessage(message) {
      if (previewImg) {
        previewImg.remove();
        previewImg = null;
      }
      previewMessage.textContent = message;
      previewMessage.style.display = 'block';
    }

    function showPreviewImage(img) {
      previewMessage.style.display = 'none';
      if (previewImg) {
        previewImg.remove();
      }
      previewImg = img;
      preview.appendChild(img);
    }

    function setCopyButtonIcon(iconName) {
      const icon = copyButton.querySelector('i');
      if (icon) {
        icon.setAttribute('data-lucide', iconName);
        lucide.createIcons();
      }
    }

    async function copyCode() {
      const code = codeOutput.textContent;
      await navigator.clipboard.writeText(code);
      copyButton.classList.add('copied');
      setCopyButtonIcon('check');
      setTimeout(() => {
        copyButton.classList.remove('copied');
        setCopyButtonIcon('copy');
      }, 2000);
    }

    copyButton.addEventListener('click', copyCode);

    codeTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        codeTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentFormat = tab.dataset.format;
        updateCodeOutput();
      });
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const url = buildUrl();
      if (!url) {
        showPreviewMessage('Please enter a username');
        codeSection.style.display = 'none';
        return;
      }

      showPreviewMessage('Loading...');

      const img = document.createElement('img');
      img.onload = () => {
        showPreviewImage(img);
        currentUrl = url;
        codeSection.style.display = 'block';
        updateCodeOutput();
      };
      img.onerror = () => {
        showPreviewMessage('Failed to load. Check the username.');
        codeSection.style.display = 'none';
      };
      img.src = url;
      img.alt = 'Top Languages';
    });
  </script>
</body>
</html>
