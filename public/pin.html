<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Generate beautiful Repository Pin cards for your GitHub profile README.">
  <title>Repository Pin Generator - DevCard</title>
  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <link rel="stylesheet" href="/styles/shared.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="/" class="logo">
          <i data-lucide="bar-chart-3"></i>
          <span>DevCard</span>
        </a>
        <nav class="nav-links">
          <a href="/stats.html" class="nav-link">
            <i data-lucide="bar-chart-2" style="width: 16px; height: 16px;"></i>
            Stats
          </a>
          <a href="/languages.html" class="nav-link">
            <i data-lucide="code-2" style="width: 16px; height: 16px;"></i>
            Languages
          </a>
          <a href="/pin.html" class="nav-link active">
            <i data-lucide="pin" style="width: 16px; height: 16px;"></i>
            Pin
          </a>
          <a href="https://github.com/paveg/devcard" class="nav-link" target="_blank" rel="noopener">
            <i data-lucide="github" style="width: 18px; height: 18px;"></i>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <h1 class="page-title">Repository Pin Generator</h1>
      <p class="page-description">Highlight your best repositories with beautiful pin cards.</p>

      <div class="generator-section">
        <div class="form-panel">
          <form id="generatorForm">
            <div class="form-group">
              <label for="username" class="form-label">GitHub Username *</label>
              <input type="text" id="username" class="input" placeholder="octocat" required>
            </div>

            <div class="form-group">
              <label for="repo" class="form-label">Repository Name *</label>
              <input type="text" id="repo" class="input" placeholder="Hello-World" required>
            </div>

            <div class="form-group">
              <label for="theme" class="form-label">Theme</label>
              <select id="theme" class="select">
                <option value="">Default</option>
                <option value="dark">Dark</option>
                <option value="radical">Radical</option>
                <option value="tokyonight">Tokyo Night</option>
                <option value="dracula">Dracula</option>
                <option value="github_dark">GitHub Dark</option>
                <option value="github_light">GitHub Light</option>
                <option value="gruvbox">Gruvbox</option>
                <option value="nord">Nord</option>
                <option value="catppuccin_mocha">Catppuccin Mocha</option>
                <option value="catppuccin_latte">Catppuccin Latte</option>
                <option value="onedark">One Dark</option>
                <option value="cobalt">Cobalt</option>
                <option value="synthwave">Synthwave</option>
                <option value="transparent">Transparent</option>
                <option value="md3_light">Material 3 Light</option>
                <option value="md3_dark">Material 3 Dark</option>
                <option value="zinc">Zinc</option>
                <option value="slate">Slate</option>
              </select>
            </div>

            <div class="form-group">
              <label for="locale" class="form-label">Language</label>
              <select id="locale" class="select">
                <option value="">English</option>
                <option value="ja">Japanese</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Options</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="show_owner">
                  Show Owner
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="hide_border">
                  Hide Border
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="disable_animations">
                  No Animation
                </label>
              </div>
            </div>

            <div class="collapsible-header" onclick="toggleAdvanced()">
              <h3>Advanced Options</h3>
              <i data-lucide="chevron-down" id="advancedIcon" style="width: 16px; height: 16px;"></i>
            </div>
            <div class="collapsible-content" id="advancedOptions">
              <div class="form-group">
                <label for="description_lines_count" class="form-label">Description Lines</label>
                <input type="number" id="description_lines_count" class="input" placeholder="2" min="1" max="5">
                <p class="form-hint">Number of lines for description (1-5)</p>
              </div>
            </div>

            <div class="form-group" style="margin-top: 1.5rem;">
              <button type="submit" class="button">
                <i data-lucide="image" style="width: 16px; height: 16px;"></i>
                Generate Card
              </button>
            </div>
          </form>
        </div>

        <div class="preview-panel">
          <div class="preview-header">
            <h2 class="preview-title">Preview</h2>
          </div>

          <div class="preview-container" id="preview">
            <div class="preview-loading" id="previewMessage">Enter username and repo to generate preview</div>
          </div>

          <div class="code-section" id="codeSection" style="display: none;">
            <div class="code-tabs">
              <button class="code-tab active" data-format="markdown">Markdown</button>
              <button class="code-tab" data-format="html">HTML</button>
              <button class="code-tab" data-format="url">URL</button>
            </div>
            <div class="code-block">
              <button class="copy-button" id="copyButton">
                <i data-lucide="copy" style="width: 14px; height: 14px;"></i>
              </button>
              <code id="codeOutput"></code>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>
        Made with care by <a href="https://github.com/paveg" target="_blank" rel="noopener">paveg</a>
        &bull;
        <a href="https://github.com/paveg/devcard" target="_blank" rel="noopener">View on GitHub</a>
      </p>
    </div>
  </footer>

  <script>
    lucide.createIcons();

    const form = document.getElementById('generatorForm');
    const preview = document.getElementById('preview');
    const previewMessage = document.getElementById('previewMessage');
    const codeSection = document.getElementById('codeSection');
    const codeOutput = document.getElementById('codeOutput');
    const codeTabs = document.querySelectorAll('.code-tab');
    const copyButton = document.getElementById('copyButton');

    let currentUrl = '';
    let currentFormat = 'markdown';
    let previewImg = null;

    function toggleAdvanced() {
      const content = document.getElementById('advancedOptions');
      const icon = document.getElementById('advancedIcon');
      content.classList.toggle('open');
      icon.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : '';
    }

    function buildUrl() {
      const baseUrl = window.location.origin;
      const params = new URLSearchParams();

      const username = document.getElementById('username').value.trim();
      const repo = document.getElementById('repo').value.trim();
      if (!username || !repo) return null;

      params.set('username', username);
      params.set('repo', repo);

      const theme = document.getElementById('theme').value;
      if (theme) params.set('theme', theme);

      const locale = document.getElementById('locale').value;
      if (locale) params.set('locale', locale);

      if (document.getElementById('show_owner').checked) params.set('show_owner', 'true');
      if (document.getElementById('hide_border').checked) params.set('hide_border', 'true');
      if (document.getElementById('disable_animations').checked) params.set('disable_animations', 'true');

      const descLinesCount = document.getElementById('description_lines_count').value;
      if (descLinesCount) params.set('description_lines_count', descLinesCount);

      return `${baseUrl}/api/pin?${params.toString()}`;
    }

    function getCodeSnippet(url, format) {
      const repo = document.getElementById('repo').value.trim();
      switch (format) {
        case 'markdown':
          return `![${repo}](${url})`;
        case 'html':
          return `<img src="${url}" alt="${repo}" />`;
        case 'url':
          return url;
        default:
          return url;
      }
    }

    function updateCodeOutput() {
      if (!currentUrl) return;
      codeOutput.textContent = getCodeSnippet(currentUrl, currentFormat);
    }

    function showPreviewMessage(message) {
      if (previewImg) {
        previewImg.remove();
        previewImg = null;
      }
      previewMessage.textContent = message;
      previewMessage.style.display = 'block';
    }

    function showPreviewImage(img) {
      previewMessage.style.display = 'none';
      if (previewImg) {
        previewImg.remove();
      }
      previewImg = img;
      preview.appendChild(img);
    }

    function setCopyButtonIcon(iconName) {
      const icon = copyButton.querySelector('i');
      if (icon) {
        icon.setAttribute('data-lucide', iconName);
        lucide.createIcons();
      }
    }

    async function copyCode() {
      const code = codeOutput.textContent;
      await navigator.clipboard.writeText(code);
      copyButton.classList.add('copied');
      setCopyButtonIcon('check');
      setTimeout(() => {
        copyButton.classList.remove('copied');
        setCopyButtonIcon('copy');
      }, 2000);
    }

    copyButton.addEventListener('click', copyCode);

    codeTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        codeTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentFormat = tab.dataset.format;
        updateCodeOutput();
      });
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const url = buildUrl();
      if (!url) {
        showPreviewMessage('Please enter username and repository');
        codeSection.style.display = 'none';
        return;
      }

      showPreviewMessage('Loading...');

      const img = document.createElement('img');
      img.onload = () => {
        showPreviewImage(img);
        currentUrl = url;
        codeSection.style.display = 'block';
        updateCodeOutput();
      };
      img.onerror = () => {
        showPreviewMessage('Failed to load. Check the username and repo.');
        codeSection.style.display = 'none';
      };
      img.src = url;
      img.alt = 'Repository Pin';
    });
  </script>
</body>
</html>
